<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
    <title>Timetable Generator</title>
</head>

<body>
    <div class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">
        <span class="theme-text">Dark</span>
    </div>
    <div class="container">
        <!-- Left column: General Settings -->
        <div class="control-panel">
            <h2>General Settings</h2>

            <div class="form-group">
                <label for="shortName">Short Name:</label>
                <input type="text" id="shortName" placeholder="Enter short name">
            </div>

            <div class="form-group">
                <label for="initials">Initials:</label>
                <input type="text" id="initials" placeholder="Enter initials">
            </div>

            <div class="form-group">
                <label for="tutorGroup">Tutor Group:</label>
                <input type="text" id="tutorGroup" placeholder="Enter tutor group">
            </div>

            <div class="form-group">
                <label for="nameDisplay">Name Display:</label>
                <select id="nameDisplay">
                    <option value="none">None</option>
                    <option value="short">Short Name</option>
                    <option value="initials">Initials</option>
                    <option value="tutor">Tutor Group</option>
                    <option value="both">Both (Tutor + Initials)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Days to Display:</label>
                <div id="daysCheckboxes"></div>
            </div>

            <div class="form-group">
                <label>Periods to Display:</label>
                <div class="checkbox-group" id="periodsCheckboxes"></div>
            </div>
        </div>

        <!-- Middle column: Timetable + Presets -->
        <div class="middle-column">
            <!-- Timetable at top -->
            <div class="control-panel timetable-panel">
                <h2>Timetable Preview</h2>
                <div class="timetable-controls">
                    <button onclick="generateTimetable()">Generate</button>
                    <button class="secondary" onclick="downloadImage()">Download PNG</button>
                </div>
                <div class="timetable-container">
                    <canvas id="timetableCanvas" class="hidden"></canvas>
                    <div id="timetableWrapper" class="timetable-wrapper">
                        <table class="timetable" id="timetableTable">
                            <tbody id="timetableBody">
                                <tr>
                                    <td colspan="100%" class="placeholder-text">Configure and generate</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Presets below timetable -->
            <div class="control-panel">
                <h2>Lesson Presets</h2>
                <button onclick="addPreset()" style="margin: 0 0 12px 0;">Add Preset</button>
                <div class="form-group">
                    <div id="presetsList"></div>
                </div>
            </div>
        </div>

        <!-- Right column: Current Lessons -->
        <div class="control-panel">
            <h2>Current Lessons</h2>

            <div class="button-row">
                <button onclick="addEvent()">Add Event</button>
                <button class="secondary" onclick="openUploadModal()">Import PDF</button>
                <button class="secondary" onclick="openJSONModal()">JSON</button>
            </div>

            <div class="form-group events-list-container">
                <label>Events List:</label>
                <div class="events-list" id="eventsList"></div>
            </div>
        </div>
    </div>

    <!-- Modal for adding/editing events -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">Add New Event</h3>

            <div class="preset-section">
                <label for="presetSelect">Use Preset:</label>
                <select id="presetSelect" onchange="applyPreset()">
                    <option value="">Select a preset...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="eventDay">Day:</label>
                <select id="eventDay"></select>
            </div>

            <div class="form-group">
                <label for="eventPeriod">Period:</label>
                <select id="eventPeriod"></select>
            </div>

            <div class="form-group">
                <label for="eventSubject">Subject:</label>
                <input type="text" id="eventSubject" placeholder="Enter subject">
            </div>

            <div class="form-group">
                <label for="eventRoom">Room:</label>
                <input type="text" id="eventRoom" placeholder="Enter room">
            </div>

            <div class="form-group">
                <label for="eventStaff">Staff:</label>
                <input type="text" id="eventStaff" placeholder="Enter staff name">
            </div>

            <div class="form-group">
                <label for="eventColor">Color:</label>
                <input type="color" id="eventColor" value="#e3f2fd">
            </div>

            <button onclick="saveEvent()">Save Event</button>
            <button class="secondary" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <!-- Modal for adding/editing presets -->
    <div id="presetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePresetModal()">&times;</span>
            <h3 id="presetModalTitle">Add Preset</h3>

            <div class="form-group">
                <label for="presetSubject">Subject:</label>
                <input type="text" id="presetSubject" placeholder="Enter subject name">
            </div>

            <div class="form-group">
                <label for="presetStaff">Staff:</label>
                <input type="text" id="presetStaff" placeholder="Enter staff name">
            </div>

            <div class="form-group">
                <label for="presetColor">Color:</label>
                <input type="color" id="presetColor" value="#e3f2fd">
            </div>

            <button onclick="savePreset()">Save Preset</button>
            <button class="secondary" onclick="closePresetModal()">Cancel</button>
        </div>
    </div>

    <!-- Modal for uploading PDF -->
    <div id="uploadModal" class="modal">
        <div class="modal-content upload-modal-content">
            <span class="close" onclick="closeUploadModal()">&times;</span>
            <h3>Import from PDF</h3>

            <div class="form-group">
                <label for="pdfUpload">Select Timetable PDF:</label>
                <input type="file" id="pdfUpload" accept=".pdf" class="file-input">
            </div>

            <div class="form-group">
                <label class="checkbox-label-inline">
                    <input type="checkbox" id="includeStudyPeriods" checked>
                    <span>Include study periods</span>
                </label>
            </div>

            <div class="form-group">
                <label class="checkbox-label-inline">
                    <input type="checkbox" id="pdfDaysAsRows" checked>
                    <span>Days as rows (staff view)</span>
                </label>
                <div class="checkbox-hint">Uncheck for parent view (days as columns)</div>
            </div>

            <div id="pdfStatus" class="pdf-status"></div>

            <button onclick="processPDF()">Import PDF</button>
            <button class="secondary" onclick="closeUploadModal()">Cancel</button>

            <hr class="modal-divider">

            <div class="subject-mapping-header">
                <h4>Subject Keyword Mappings</h4>
                <button onclick="addMapping()" class="btn-small">+ Add</button>
            </div>

            <p class="subject-mapping-hint">
                Each row maps keyword(s) found in raw PDF cell text → a short subject name and colour.
                Keywords are comma-separated, case-insensitive substrings.
                Rows are checked in order — first match wins.
            </p>

            <div class="mapping-columns-header">
                <span class="col-subject">Subject</span>
                <span class="col-keywords">Keywords (comma separated)</span>
                <span class="col-color">Col</span>
                <span class="col-actions"></span>
            </div>

            <div id="subjectMappingsContainer"></div>
        </div>
    </div>

    <!-- Modal for JSON Import/Export -->
    <div id="jsonModal" class="modal json-modal">
        <div class="modal-content">
            <span class="close" onclick="closeJSONModal()">&times;</span>
            <h3>Import/Export JSON</h3>

            <div class="form-group">
                <label for="jsonTextarea">JSON Data:</label>
                <textarea id="jsonTextarea" class="json-textarea" placeholder="Paste JSON data here..."></textarea>
            </div>

            <div class="json-buttons">
                <button onclick="importJSON()">Import JSON</button>
                <button class="secondary" onclick="exportJSON()">Export to Textarea</button>
                <button class="secondary" onclick="downloadJSON()">Download JSON File</button>
            </div>

            <div class="form-group">
                <label>Upload JSON File:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="jsonFileInput" accept=".json" onchange="handleJSONFileUpload(event)">
                    <label for="jsonFileInput" class="file-input-label">Choose JSON File</label>
                </div>
                <div id="fileUploadStatus"></div>
            </div>

            <div id="jsonModalMessage"></div>

            <button class="secondary" onclick="closeJSONModal()">Close</button>
        </div>
    </div>
</body>

</html>
